<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>별 띄우기 - 심플별 & 버튼</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <style>
    body {
      margin:0; padding:0;
      min-height:100vh;
      background:radial-gradient(ellipse at bottom, #282c38 0%, #060717 100%);
      overflow:hidden;
      font-family:'Malgun Gothic',sans-serif;
      position:relative;
    }
    #starsInSky {
      position:absolute;
      width:100vw;height:100vh;top:0;left:0;
      pointer-events:none;
      z-index:11;
    }
    .big-star {
      position:absolute;
      width:18px;height:18px;
      left:0;top:0;transform:translate(-50%,-50%);
      background: #ffe066;
      border-radius: 50%;
      border: none;
      box-shadow: 0 0 7px 2px #ffe06677, 0 0 0 1.5px #fff8cc;
      z-index:10;
      pointer-events:auto;
      cursor:pointer;
      user-select:none;
      transition:box-shadow .18s;
      outline:none;
    }
    .big-star:active, .big-star:hover {
      box-shadow:0 0 16px 6px #ffe066cc, 0 0 0 2px #fff8cc;
    }
    .star {
      position:absolute;width:2px;height:2px;background:white;border-radius:50%;
      opacity:0.7;animation:twinkle 2s infinite alternate;pointer-events:none;
    }
    @keyframes twinkle {from {opacity:0.65;} to {opacity:1;}}
    .center-btn {
      position:absolute;
      bottom:60px; left:50%; transform:translateX(-50%);
      background: #f8f9fa;
      color: #232323;
      border:none;
      border-radius: 30px;
      padding: 16px 34px;
      font-size: 17px;
      font-weight: 600;
      cursor:pointer;
      box-shadow: 0 2.5px 16px rgba(0,0,0,0.03);
      z-index:50;
      letter-spacing:0.02em;
      transition:background .17s,color .18s;
      outline:none;
    }
    .center-btn:hover, .center-btn:focus { background:#ececec; color:#3b3464; }
    .modal{
      display:none;
      position:fixed;
      top:0;left:0;width:100vw;height:100vh;
      background:rgba(0,0,0,0.75);
      z-index:100;justify-content:center;align-items:center;
    }
    .modal.open{display:flex;}
    .modal-content{
      background:#23253a;
      padding:30px 20px 20px;
      border-radius:17px;
      min-width:320px;
      text-align:center;
      color:#fff;
      position:relative;
    }
    #profile-canvas {
      border-radius:12px;
      box-shadow:0 2px 8px rgba(0,0,0,0.12);
      border:2px solid #ececec;
      background:#23253a;
      display:block;
      margin:0 auto 10px auto;
      width:240px;height:240px;
      max-width:100%;max-height:60vw;
    }
    #signatureModalCanvas {
      width:240px; height:240px;
      border-radius:12px;
      border:2px solid #ffe066;
      background:#fff;
      max-width:100%;max-height:60vw;
    }
    .modal-content button{
      margin-top:10px;
      background:#efefef;color:#23253a;
      border:none;
      border-radius:8px;
      padding:9px 24px;
      font-size:15px;
      cursor:pointer;
      font-weight:500;
      box-shadow:0 2px 8px rgba(0,0,0,0.04);
    }
    .modal-content button:hover{background:#e2e2e2;}
    .feedback-msg{
      position:fixed;
      top:84px;left:50%;transform:translateX(-50%);
      background:#23253a;color:#ffe066;
      padding:13px 25px;
      border-radius:13px;
      font-size:17px;
      font-weight:600;
      z-index:200;
      display:none;
      box-shadow:0 3px 10px rgba(0,0,0,0.08);
    }

    /* 모바일 및 태블릿 대응 */
    @media (max-width: 768px) {
      .modal-content {
        width: 94vw !important;
        max-width: 94vw !important;
        padding:12vw 2vw 2vw !important;
        min-width:0;
      }
      #profile-canvas, #signatureModalCanvas {
        width:88vw !important;
        height:88vw !important;
        max-width:88vw !important;
        max-height:88vw !important;
      }
      .center-btn {
        bottom:36px !important;
        padding: 14px 20px !important;
        font-size: 16px !important;
        width: 92vw !important;
        max-width: 92vw !important;
        border-radius: 18px !important;
      }
    }
    @media (max-width: 480px) {
      .modal-content {
        padding:7vw 1vw 1vw !important;
      }
      #profile-canvas, #signatureModalCanvas {
        width:92vw !important;
        height:92vw !important;
        max-width:92vw !important;
        max-height:92vw !important;
      }
      .center-btn {
        font-size:15px !important;
        bottom:17px !important;
        padding:12px 12px !important;
      }
    }
  </style>
</head>
<body>
  <div id="stars"></div>
  <div id="starsInSky"></div>
  <div class="feedback-msg" id="feedbackMsg"></div>
  <button class="center-btn" id="makeStarBtn"></button>
  <div class="modal" id="modal"><div class="modal-content">
    <canvas id="profile-canvas" width="240" height="240"></canvas>
    <button id="launchStarBtn" type="button">별을 띄우기</button>
  </div></div>
  <div class="modal" id="signatureModal">
    <div class="modal-content">
      <canvas id="signatureModalCanvas" width="240" height="240"></canvas>
      <br>
      <button onclick="document.getElementById('signatureModal').classList.remove('open');">닫기</button>
    </div>
  </div>
  <script>
    // 밤하늘 배경 별
    for(let i=0;i<60;i++){
      const st=document.createElement('div');
      st.className='star';
      st.style.top=Math.random()*60+'%';
      st.style.left=Math.random()*100+'%';
      st.style.opacity=0.6+Math.random()*0.4;
      st.style.width=st.style.height=`${1+Math.random()*2}px`;
      st.style.animationDuration=`${1+Math.random()*2}s`;
      document.getElementById('stars').appendChild(st);
    }

    const modal=document.getElementById('modal');
    const signatureModal=document.getElementById('signatureModal');
    const makeStarBtn=document.getElementById('makeStarBtn');
    const launchStarBtn=document.getElementById('launchStarBtn');
    const canvas=document.getElementById('profile-canvas');
    const ctx=canvas.getContext('2d');
    const sigModalCanvas = document.getElementById('signatureModalCanvas');
    const sigModalCtx = sigModalCanvas.getContext('2d');

    let img=new window.Image();
    img.src="1.png";
    img.onload=function(){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0,canvas.width,canvas.height);}
    let drawing = false, signature = [];

    // 서명 입력 가능 영역 지정
    function isInSignArea(y){return y>=canvas.height*0.85&&y<=canvas.height*0.93;}
    function isInHorizontalSignArea(x){return x>=canvas.width*0.4&&x<=canvas.width*0.6;}
    function isInSignAreaWithHorizontal(x,y){return isInSignArea(y)&&isInHorizontalSignArea(x);}
    function drawProfile(bgImg,sigPoints){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
      ctx.strokeStyle="#222"; ctx.lineWidth=3; ctx.lineCap="round";
      if(sigPoints&&sigPoints.length){
        ctx.beginPath();
        for(let i=0;i<sigPoints.length;i++){
          const p=sigPoints[i];
          if(p.move)ctx.moveTo(p.x,p.y);
          else ctx.lineTo(p.x,p.y);
        }
        ctx.stroke();
      }
    }
    // 서명 입력 이벤트
    canvas.addEventListener('mousedown',e=>{
      if(isInSignAreaWithHorizontal(e.offsetX,e.offsetY)){
        drawing=true;
        signature.push({x:e.offsetX,y:e.offsetY,move:true});
        drawProfile(img,signature);
      }
    });
    canvas.addEventListener('mousemove',e=>{
      if(drawing){
        signature.push({x:e.offsetX,y:e.offsetY,move:false});
        drawProfile(img,signature);
      }
    });
    canvas.addEventListener('mouseup',()=>drawing=false);
    canvas.addEventListener('mouseleave',()=>drawing=false);
    canvas.addEventListener('touchstart',(e)=>{
      e.preventDefault();
      let t=e.touches[0],r=canvas.getBoundingClientRect(),x=t.clientX-r.left,y=t.clientY-r.top;
      if(isInSignAreaWithHorizontal(x,y)){
        drawing=true;
        signature.push({x,y,move:true});
        drawProfile(img,signature);
      }
    },{passive:false});
    canvas.addEventListener('touchmove',(e)=>{
      e.preventDefault();
      if(drawing){
        let t=e.touches[0],r=canvas.getBoundingClientRect();
        signature.push({x:t.clientX-r.left,y:t.clientY-r.top,move:false});
        drawProfile(img,signature);
      }
    },{passive:false});
    canvas.addEventListener('touchend',()=>drawing=false);

    // 별 저장/출력
    function saveStar(top, left, sig) {
      let starArr = JSON.parse(localStorage.getItem('bigStars')||'[]');
      starArr.push({ top: top+'%', left: left+'%', sig });
      localStorage.setItem('bigStars', JSON.stringify(starArr));
    }
    function showAllStars(){
      const sky=document.getElementById('starsInSky');
      sky.innerHTML = '';
      const starArr = JSON.parse(localStorage.getItem('bigStars')||'[]');
      starArr.forEach(star=>{
        const b=document.createElement('div');
        b.className='big-star';
        b.style.top=star.top;
        b.style.left=star.left;
        b.onclick=function(e){
          e.stopPropagation();
          showSignatureWithBgModal(star.sig);
          showFeedback('별을 클릭하면 당신의 선언문이 보입니다!');
        }
        sky.appendChild(b);
      });
      makeStarBtn.textContent = (starArr.length+1)+'번째 절주선언문 작성하기';
      makeStarBtn.style.display=''; // 항상 노출
    }
    function showSignatureWithBgModal(sig){
      let modalBgImg = new window.Image();
      modalBgImg.onload = function(){
        sigModalCtx.clearRect(0,0,240,240);
        sigModalCtx.drawImage(modalBgImg,0,0,240,240);
        sigModalCtx.strokeStyle="#222";
        sigModalCtx.lineWidth=3;
        sigModalCtx.lineCap="round";
        if(sig && sig.length){
          sigModalCtx.beginPath();
          for(let i=0;i<sig.length;i++){
            const p=sig[i];
            if(p.move) sigModalCtx.moveTo(p.x,p.y);
            else sigModalCtx.lineTo(p.x,p.y);
          }
          sigModalCtx.stroke();
        }
        signatureModal.classList.add('open');
      };
      modalBgImg.src = "1.png";
    }

    // 별 띄우기(별 사인만 기록)
    launchStarBtn.onclick=function(e){
      e.preventDefault();
      const sigCopy = JSON.parse(JSON.stringify(signature));
      const top=10+Math.random()*60, left=10+Math.random()*80;
      saveStar(top, left, sigCopy);
      modal.classList.remove('open');
      showAllStars();
    };
    // 버튼 이벤트
    makeStarBtn.onclick=()=>{
      modal.classList.add('open');
      signature=[];
      drawProfile(img,signature);
    }
    showAllStars();

    function showFeedback(msg){
      const feedbackMsg=document.getElementById('feedbackMsg');
      feedbackMsg.innerHTML=msg;
      feedbackMsg.style.display='block';
      setTimeout(()=>{feedbackMsg.style.display='none';},2000);
    }
    // 모달 외부 클릭시 닫힘
    window.onclick=function(e){
      if(e.target===modal) modal.classList.remove('open');
      if(e.target===signatureModal) signatureModal.classList.remove('open');
    };
  </script>
</body>
</html>
